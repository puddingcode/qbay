(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8b3fef2a"],{"5e47":function(t,e,o){"use strict";o.r(e);o("a4d3"),o("e01a"),o("4de4"),o("a434"),o("b0c0"),o("a9e3");var r=o("5530"),i=o("2f62"),a=o("4260"),s=o("874c"),n=o("e43c"),c=o("a15e"),l={created:function(){this.isModifyPage&&this.getProductInfo()},data:function(){return{avatarLoading:!1,form:{id:"",shop_id:this.$store.state.user.loginData.id,category_id:"",name:"",description:"",size:[],status:1,oss_url:""},choose:{size:"L",house_price:null,pack_price:null},specification:[{}],types:[{value:"L",label:"L"},{value:"M",label:"M"},{value:"S",label:"S"}],isModifyPage:this.$route.params.id,isComplete:!1,sortErrStatus:!1,sortErrMsg:"",isClickCompleteBtn:!1}},computed:Object(r.a)({rules:function(){return{description:[{required:!0,message:this.$t("commodity.descriptionErrMsg"),trigger:"blur"}],category_id:[{required:!0,type:"number",message:this.$t("commodity.categoryErrMsg"),trigger:"blur"}],name:[{required:!0,message:this.$t("commodity.nameErrMsg"),trigger:"blur"}]}},chooseRules:function(){var t=this;return{size:[{required:!0},{validator:function(e,o,r){t.form.size.filter((function(t){return t.size===o})).length&&r(new Error(t.$t("error.sameNameErr"))),r()}}]}}},Object(i.d)({commoditySort:function(t){return t.commodity.commodityCategorityList},commodityInfo:function(t){return t.commodity.commodityInfo}})),methods:Object(r.a)(Object(r.a)({},Object(i.b)({modifyCommmodity:"commodity/modifyCommodity",addCommodity:"commodity/addCommodity"})),{},{addSpecification:function(){this.validateSortInfo()},validateSortInfo:function(){var t=this;new c.default(this.chooseRules).validate(this.choose,(function(e,o){if(console.log(o),e)t.sortErrStatus=!0,t.sortErrMsg=e[0].message,setTimeout((function(){t.sortErrMsg=""}),1e3);else{var r=t.choose,i=r.size,a=r.house_price,s=r.pack_price;if(null==a&&null==s)return t.sortErrStatus=!0,t.sortErrMsg=t.$t("commodity.priceCountErr"),void setTimeout((function(){t.sortErrMsg=""}),1e3);t.sortErrStatus=!1,t.isClickCompleteBtn||(t.form.size.push({size:i,house_price:a?Number(a):null,pack_price:s?Number(s):null}),t.choose.house_price=null,t.choose.pack_price=null)}}))},deleteSpecification:function(t){this.form.size.splice(t.$index,1)},returnList:function(){this.$router.push({name:"Commodity List"})},complete:function(){var t=this;this.$refs.form.validate((function(e){e&&(console.log(t.form.size.length),t.form.size.length>0?(t.isComplete=!0,t.isModifyPage?t.modifyCom():t.addCom()):(t.validateSortInfo(),console.log(t.sortErrStatus),t.sortErrStatus||(t.isComplete=!0,t.isModifyPage?t.modifyCom():t.addCom())))}))},modifyCom:function(){var t=this;this.modifyCommmodity(this.form).then((function(){t.isComplete=!1,t.$alert(t.$t("commodity.alterInfo"),{confirmButtonText:t.$t("btn.confirm"),callback:function(){t.$router.push({name:"Commodity List"})}})}))},addCom:function(){var t=this;delete this.form.id;var e=Object(r.a)({},this.form);this.addCommodity(e).then((function(e){t.isComplete=!1,0===e.data.code?t.$message.error(t.$t("error.sameNameErr")):t.$confirm(t.$t("commodity.confirmInfo"),"tips",{confirmButtonText:t.$t("btn.confirm"),cancelButtonText:t.$t("btn.cancel")}).then((function(){t.form.category_id="",t.form.name="",t.form.description="",t.form.oss_url="",t.form.size=[],t.choose.house_price="",t.choose.pack_price="",t.choose.left=""})).catch((function(){t.$router.push({name:"Commodity List"})}))}),(function(){t.isComplete=!1}))},getProductInfo:function(){var t=this,e=this.$route.params.id;this.$store.dispatch("commodity/getProductInfo",e).then((function(e){var o=Object(a.d)(e,["category_id","name","description","size","id","shop_id","oss_url"]);t.form=Object(r.a)(Object(r.a)({},t.form),o)}))},beforeAvatarUpload:function(t){var e="image/jpeg"===t.type||"image/png",o=t.size/1024/1024<2;e||this.$message.error(this.$t("error.picTypeErr")),o||this.$message.error(this.$t("error.picMaxErr"))},uploadFile:function(t){var e=this;console.log(t),this.avatarLoading=!0,Object(s.b)(t).then((function(t){e.avatarLoading=!1,Object(n.a)(),e.form.oss_url=t.Location}),(function(t){e.avatarLoading=!1,Object(n.a)(),t.msg||e.$message.error(e.$t("error.picUploadErr"))}))}}),components:{}},u=(o("60f5"),o("2877")),d=Object(u.a)(l,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-scrollbar",{staticClass:"adding_goods_wrapper"},[o("div",{staticClass:"addinggoods_content_wrapper"},[o("div",{staticClass:"commodityTitle"},[t._v(t._s(t.$t("commodity.information")))]),o("el-row",{attrs:{type:"flex"}},[o("el-col",{staticClass:"picture_wrapper",attrs:{lg:{span:5},span:8}},[o("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.uploadFile,"before-upload":t.beforeAvatarUpload}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.avatarLoading,expression:"avatarLoading"}],staticClass:"avatar_loading"}),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.avatarLoading,expression:"!avatarLoading"}]},[o("img",{staticClass:"avatar",attrs:{src:t.form.oss_url}}),o("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" "+t._s(t.$t("public.picInfo"))+" ")])])])],1),o("el-col",{staticClass:"information_wrapper",attrs:{lg:{span:19},span:16}},[o("el-form",{ref:"form",attrs:{model:t.form,"label-position":"left","label-width":"100px",rules:t.rules}},[o("el-form-item",{attrs:{label:t.$t("commodity.sort"),prop:"category_id"}},[o("el-select",{model:{value:t.form.category_id,callback:function(e){t.$set(t.form,"category_id",e)},expression:"form.category_id"}},t._l(t.commoditySort,(function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),o("el-form-item",{attrs:{label:t.$t("commodity.name"),prop:"name"}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:t.$t("commodity.description"),prop:"description"}},[o("el-input",{model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1)],1)],1),o("el-divider"),o("el-row",[o("el-col",{attrs:{span:12}},[o("el-table",{attrs:{data:t.specification}},[o("el-table-column",{attrs:{label:t.$t("commodity.specification"),width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-select",{attrs:{label:e},model:{value:t.choose.size,callback:function(e){t.$set(t.choose,"size",e)},expression:"choose.size"}},t._l(t.types,(function(t){return o("el-option",{key:t.value,attrs:{label:t.value,value:t.value}})})),1)]}}])}),o("el-table-column",{attrs:{label:t.$t("commodity.dineInPrice"),width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-input",{attrs:{type:"number",label:e.$index.toString(),placeholder:t.$t("commodity.pricePlaceholder")},model:{value:t.choose.house_price,callback:function(e){t.$set(t.choose,"house_price",t._n(e))},expression:"choose.house_price"}})]}}])}),o("el-table-column",{attrs:{label:t.$t("commodity.takeAwayPrice"),width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-input",{attrs:{type:"number",label:e.$index.toString(),placeholder:t.$t("commodity.pricePlaceholder")},model:{value:t.choose.pack_price,callback:function(e){t.$set(t.choose,"pack_price",t._n(e))},expression:"choose.pack_price"}})]}}])}),o("el-table-column",{attrs:{width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(o){return t.addSpecification(e)}}},[t._v(t._s(t.$t("btn.add")))])]}}])})],1),o("div",{staticClass:"sort_error"},[t._v(t._s(t.sortErrMsg))]),o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.form.size}},[o("el-table-column",{attrs:{prop:"size",width:"width"}}),o("el-table-column",{attrs:{prop:"house_price",width:"width"}}),o("el-table-column",{attrs:{prop:"pack_price",width:"width"}}),o("el-table-column",{attrs:{width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(o){return t.deleteSpecification(e)}}},[t._v(t._s(t.$t("btn.delete")))])]}}])})],1)],1)],1),o("el-row",{attrs:{gutter:10,type:"flex",justify:"center"}},[o("el-col",{attrs:{span:8}},[t.isModifyPage?o("el-button",{attrs:{type:"primary",plain:""},on:{click:t.returnList}},[t._v(t._s(t.$t("btn.return")))]):t._e()],1),o("el-col",{attrs:{span:8}},[o("el-button",{attrs:{type:"primary",loading:t.isComplete},on:{click:t.complete}},[t._v(t._s(t.$t("btn.complete")))])],1)],1)],1)])}),[],!1,null,"4cc0315a",null);e.default=d.exports},"60f5":function(t,e,o){"use strict";o("b287")},"874c":function(t,e,o){"use strict";o.d(e,"b",(function(){return l})),o.d(e,"a",(function(){return u}));o("baa5"),o("fb6a"),o("b0c0"),o("d3b7");var r=o("0da4"),i=o.n(r),a=o("2b0e"),s=o("9923"),n=o("e43c");i.a.config.update({region:"ap-southeast-2",credentials:new i.a.CognitoIdentityCredentials({IdentityPoolId:"ap-southeast-2:3690eca5-99fb-4e84-8cf4-74ec0ac8162c"})});var c=new i.a.S3({apiVersion:"2006-03-01",params:{Bucket:"test.znox.top.images"}});function l(t){Object(n.b)(".avatar_loading");var e=t.file,o="image/jpeg"===e.type||"image/png"===e.type,r=e.size/1024/1024<2;if(!o)return a.default.prototype.$message({showClose:!0,message:s.a.t("error.picTypeErr"),type:"error"}),Promise.reject({msg:"uploaderr"});if(!r)return a.default.prototyoe.$message({showClose:!0,message:s.a.t("error.picMaxErr"),type:"error"}),Promise.reject({msg:"uploaderr"});var i=e.name.lastIndexOf("."),l=e.name.slice(i,e.name.length),u="static/images/"+e.uid+l;return c.upload({Bucket:"test.znox.top.images",Key:u,Body:e,ACL:"public-read"},{partSize:10485760,queueSize:1}).promise()}function u(t){var e=t.file;return console.log(e),c.upload({Bucket:"test.znox.top.images",Key:"index.html",Body:e,ACL:"public-read"}).promise().then((function(t){console.log("success",t)}),(function(t){console.log("failed",t)}))}},b287:function(t,e,o){},e43c:function(t,e,o){"use strict";o.d(e,"b",(function(){return a})),o.d(e,"a",(function(){return s}));var r,i=o("5c96");function a(t){var e={text:"loading......",background:"rgba(255, 255, 255, 0.6)",target:document.querySelector(t)||"body",customClass:"server_loading"};r=i.Loading.service(e)}function s(){r.close()}}}]);
//# sourceMappingURL=chunk-8b3fef2a.ce7e35d2.js.map