(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-950da1ac"],{"5e47":function(e,t,o){"use strict";o.r(t);o("a4d3"),o("e01a"),o("4de4"),o("a434"),o("b0c0"),o("a9e3");var r=o("5530"),i=o("2f62"),a=o("4260"),s=o("874c"),n=o("e43c"),c=o("a15e"),l={created:function(){this.isModifyPage&&this.getProductInfo()},data:function(){return{avatarLoading:!1,form:{id:"",shop_id:this.$store.state.user.loginData.id,category_id:"",name:"",description:"",size:[],status:1,oss_url:""},choose:{size:"L",house_price:null,pack_price:null},specification:[{}],types:[{value:"L",label:"L"},{value:"M",label:"M"},{value:"S",label:"S"}],isModifyPage:this.$route.params.id,isComplete:!1,sortErrStatus:!1,sortErrMsg:"",isClickCompleteBtn:!1}},computed:Object(r.a)({rules:function(){return{description:[{required:!0,message:this.$t("commodity.descriptionErrMsg"),trigger:"blur"}],category_id:[{required:!0,type:"number",message:this.$t("commodity.categoryErrMsg"),trigger:"blur"}],name:[{required:!0,message:this.$t("commodity.nameErrMsg"),trigger:"blur"}]}},chooseRules:function(){var e=this;return{size:[{required:!0},{validator:function(t,o,r){e.form.size.filter((function(e){return e.size===o})).length&&r(new Error(e.$t("error.sameNameErr"))),r()}}]}}},Object(i.d)({commoditySort:function(e){return e.commodity.commodityCategorityList},commodityInfo:function(e){return e.commodity.commodityInfo}})),methods:Object(r.a)(Object(r.a)({},Object(i.b)({modifyCommmodity:"commodity/modifyCommodity",addCommodity:"commodity/addCommodity"})),{},{addSpecification:function(){this.validateSortInfo()},validateSortInfo:function(){var e=this;new c.default(this.chooseRules).validate(this.choose,(function(t,o){if(console.log(o),t)e.sortErrStatus=!0,e.sortErrMsg=t[0].message,setTimeout((function(){e.sortErrMsg=""}),1e3);else{var r=e.choose,i=r.size,a=r.house_price,s=r.pack_price;if(null==a&&null==s)return e.sortErrStatus=!0,e.sortErrMsg=e.$t("commodity.priceCountErr"),void setTimeout((function(){e.sortErrMsg=""}),1e3);e.sortErrStatus=!1,e.isClickCompleteBtn||(e.form.size.push({size:i,house_price:a?Number(a):null,pack_price:s?Number(s):null}),e.choose.house_price=null,e.choose.pack_price=null)}}))},deleteSpecification:function(e){this.form.size.splice(e.$index,1)},returnList:function(){this.$router.push({name:"Commodity List"})},complete:function(){var e=this;this.$refs.form.validate((function(t){t&&(console.log(e.form.size.length),e.form.size.length>0?(e.isComplete=!0,e.isModifyPage?e.modifyCom():e.addCom()):(e.validateSortInfo(),console.log(e.sortErrStatus),e.sortErrStatus||(e.isComplete=!0,e.isModifyPage?e.modifyCom():e.addCom())))}))},modifyCom:function(){var e=this;this.modifyCommmodity(this.form).then((function(){e.isComplete=!1,e.$alert(e.$t("commodity.alterInfo"),{confirmButtonText:e.$t("btn.confirm"),callback:function(){e.$router.push({name:"Commodity List"})}})}))},addCom:function(){var e=this;delete this.form.id;var t=Object(r.a)({},this.form);this.addCommodity(t).then((function(t){e.isComplete=!1,0===t.data.code?e.$message.error(e.$t("error.sameNameErr")):e.$confirm(e.$t("commodity.confirmInfo"),"tips",{confirmButtonText:e.$t("btn.confirm"),cancelButtonText:e.$t("btn.cancel")}).then((function(){e.form.category_id="",e.form.name="",e.form.description="",e.form.oss_url="",e.form.size=[],e.choose.house_price="",e.choose.pack_price="",e.choose.left=""})).catch((function(){e.$router.push({name:"Commodity List"})}))}),(function(){e.isComplete=!1,e.$message.error(e.$t("error.serverErr"))}))},getProductInfo:function(){var e=this,t=this.$route.params.id;this.$store.dispatch("commodity/getProductInfo",t).then((function(t){var o=Object(a.b)(t,["category_id","name","description","size","id","shop_id","oss_url"]);e.form=Object(r.a)(Object(r.a)({},e.form),o)}))},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type||"image/png",o=e.size/1024/1024<2;t||this.$message.error(this.$t("error.picTypeErr")),o||this.$message.error(this.$t("error.picMaxErr"))},uploadFile:function(e){var t=this;console.log(e),this.avatarLoading=!0,Object(s.b)(e).then((function(e){t.avatarLoading=!1,Object(n.a)(),t.form.oss_url=e.Location}),(function(e){t.avatarLoading=!1,Object(n.a)(),e.msg||t.$message.error(t.$t("error.picUploadErr"))}))}}),components:{}},u=(o("a057"),o("2877")),d=Object(u.a)(l,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-scrollbar",{staticClass:"adding_goods_wrapper"},[o("div",{staticClass:"addinggoods_content_wrapper"},[o("div",{staticClass:"commodityTitle"},[e._v(e._s(e.$t("commodity.information")))]),o("el-row",{attrs:{type:"flex"}},[o("el-col",{staticClass:"picture_wrapper",attrs:{lg:{span:5},span:8}},[o("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.uploadFile,"before-upload":e.beforeAvatarUpload}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.avatarLoading,expression:"avatarLoading"}],staticClass:"avatar_loading"}),o("div",{directives:[{name:"show",rawName:"v-show",value:!e.avatarLoading,expression:"!avatarLoading"}]},[o("img",{staticClass:"avatar",attrs:{src:e.form.oss_url}}),o("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" "+e._s(e.$t("public.picInfo"))+" ")])])])],1),o("el-col",{staticClass:"information_wrapper",attrs:{lg:{span:19},span:16}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-position":"left","label-width":"100px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.$t("commodity.sort"),prop:"category_id"}},[o("el-select",{model:{value:e.form.category_id,callback:function(t){e.$set(e.form,"category_id",t)},expression:"form.category_id"}},e._l(e.commoditySort,(function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),o("el-form-item",{attrs:{label:e.$t("commodity.name"),prop:"name"}},[o("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:e.$t("commodity.description"),prop:"description"}},[o("el-input",{model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1),o("el-divider"),o("el-row",[o("el-col",{attrs:{span:12}},[o("el-table",{attrs:{data:e.specification}},[o("el-table-column",{attrs:{label:e.$t("commodity.specification"),width:"width"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-select",{attrs:{label:t},model:{value:e.choose.size,callback:function(t){e.$set(e.choose,"size",t)},expression:"choose.size"}},e._l(e.types,(function(e){return o("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)]}}])}),o("el-table-column",{attrs:{label:e.$t("commodity.dineInPrice"),width:"width"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{type:"number",label:t.$index.toString(),placeholder:e.$t("commodity.pricePlaceholder")},model:{value:e.choose.house_price,callback:function(t){e.$set(e.choose,"house_price",e._n(t))},expression:"choose.house_price"}})]}}])}),o("el-table-column",{attrs:{label:e.$t("commodity.takeAwayPrice"),width:"width"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{type:"number",label:t.$index.toString(),placeholder:e.$t("commodity.pricePlaceholder")},model:{value:e.choose.pack_price,callback:function(t){e.$set(e.choose,"pack_price",e._n(t))},expression:"choose.pack_price"}})]}}])}),o("el-table-column",{attrs:{width:"width"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(o){return e.addSpecification(t)}}},[e._v(e._s(e.$t("btn.add")))])]}}])})],1),o("div",{staticClass:"sort_error"},[e._v(e._s(e.sortErrMsg))]),o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.form.size}},[o("el-table-column",{attrs:{prop:"size",width:"width"}}),o("el-table-column",{attrs:{prop:"house_price",width:"width"}}),o("el-table-column",{attrs:{prop:"pack_price",width:"width"}}),o("el-table-column",{attrs:{width:"width"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(o){return e.deleteSpecification(t)}}},[e._v(e._s(e.$t("btn.delete")))])]}}])})],1)],1)],1),o("el-row",{attrs:{gutter:10,type:"flex",justify:"center"}},[o("el-col",{attrs:{span:8}},[e.isModifyPage?o("el-button",{attrs:{type:"primary",plain:""},on:{click:e.returnList}},[e._v(e._s(e.$t("btn.return")))]):e._e()],1),o("el-col",{attrs:{span:8}},[o("el-button",{attrs:{type:"primary",loading:e.isComplete},on:{click:e.complete}},[e._v(e._s(e.$t("btn.complete")))])],1)],1)],1)])}),[],!1,null,"030c5a09",null);t.default=d.exports},"874c":function(e,t,o){"use strict";o.d(t,"b",(function(){return l})),o.d(t,"a",(function(){return u}));o("baa5"),o("fb6a"),o("b0c0"),o("d3b7");var r=o("0da4"),i=o.n(r),a=o("2b0e"),s=o("9923"),n=o("e43c");i.a.config.update({region:"ap-southeast-2",credentials:new i.a.CognitoIdentityCredentials({IdentityPoolId:"ap-southeast-2:3690eca5-99fb-4e84-8cf4-74ec0ac8162c"})});var c=new i.a.S3({apiVersion:"2006-03-01",params:{Bucket:"test.znox.top.images"}});function l(e){Object(n.b)(".avatar_loading");var t=e.file,o="image/jpeg"===t.type||"image/png"===t.type,r=t.size/1024/1024<2;if(!o)return a.default.prototype.$message({showClose:!0,message:s.a.t("error.picTypeErr"),type:"error"}),Promise.reject({msg:"uploaderr"});if(!r)return a.default.prototyoe.$message({showClose:!0,message:s.a.t("error.picMaxErr"),type:"error"}),Promise.reject({msg:"uploaderr"});var i=t.name.lastIndexOf("."),l=t.name.slice(i,t.name.length),u="static/images/"+t.uid+l;return c.upload({Bucket:"test.znox.top.images",Key:u,Body:t,ACL:"public-read"},{partSize:10485760,queueSize:1}).promise()}function u(e){var t=e.file;return console.log(t),c.upload({Bucket:"test.znox.top.images",Key:"index.html",Body:t,ACL:"public-read"}).promise().then((function(e){console.log("success",e)}),(function(e){console.log("failed",e)}))}},"9a5c":function(e,t,o){},a057:function(e,t,o){"use strict";o("9a5c")},e43c:function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"a",(function(){return s}));var r,i=o("5c96");function a(e){var t={text:"loading......",background:"rgba(255, 255, 255, 0.6)",target:document.querySelector(e)||"body",customClass:"server_loading"};r=i.Loading.service(t)}function s(){r.close()}}}]);
//# sourceMappingURL=chunk-950da1ac.c72b0709.js.map