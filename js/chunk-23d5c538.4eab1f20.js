(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-23d5c538"],{2943:function(t,e,a){"use strict";a.r(e);var s=a("5530"),o=a("2f62"),r=a("4260"),i=a("874c"),n=a("e43c"),l=a("540a"),c={data:function(){return{avatarLoading:!1,options:[],set_photo_url:"",form:{id:"",shop_id:this.$store.state.user.loginData.id,category_id:"",name:"",description:"",size:[],status:1,oss_url:""},value:"",tableData:[],submitflag:!1,ruleForm:{set_name:"",set_price:"",set_time:"",set_photo_url:""},rules:{set_name:[{required:!0,message:this.$t("buffet.setMeals"),trigger:"blur"}],set_price:[{required:!0,message:this.$t("buffet.setPrices"),trigger:"blur"}],set_time:[{required:!0,message:this.$t("buffet.timeLimits"),trigger:"blur"}]}}},mounted:function(){var t=this;Object(l.getCommodityList)({offset:0,limit:999}).then((function(e){t.options=e.data.list})),this.getSetMealList()},methods:{submitForm:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return console.log("error submit!!"),!1;e.submitflag=!0,e.addSetMeal()}))},add:function(t,e,a){var s=this;this.$confirm(this.$t("buffet.addConfirm"),this.$t("buffet.tips"),{confirmButtonText:this.$t("btn.confirm"),cancelButtonText:this.$t("btn.cancel"),type:"success"}).then((function(){s.tableData[a].deletFlag=!0;var o={shop_id:s.shopId,buffet_id:t,products_id:e};s.$store.dispatch("commodity/addBuffetProduct",o).then((function(t){console.log(t,"成功"),s.getSetMealList(),s.$message({type:"success",message:s.$t("public.addSuccessMsg")})})).catch((function(t){console.log(t),"The product has been in the buffet."==t.data.message&&s.$message.error(s.$t("buffet.repeat"))}))})).catch((function(){s.$message({type:"info",message:s.$t("btn.cancel")})}))},delet:function(t,e){var a=this;this.tableData[e].deletFlag=!0,console.log(this.tableData);var s={shop_id:this.shopId,buffet_id:t};this.$store.dispatch("commodity/delBuffet",s).then((function(t){console.log(t,"成功删除"),a.getSetMealList()})).catch((function(t){console.log(t),a.deletFlag=!1,a.$message.error(t)}))},addSetMeal:function(){var t=this,e={shop_id:this.shopId,set_name:this.ruleForm.set_name,set_price:parseInt(this.ruleForm.set_price),set_time:parseInt(this.ruleForm.set_time),set_photo_url:this.set_photo_url};this.$store.dispatch("commodity/addSetMeal",e).then((function(e){console.log(e,"1111"),t.getSetMealList()})).catch((function(e){3001==e.data.code&&t.$message.error(t.$t("buffet.packgeRepeat")),t.submitflag=!1}))},getSetMealList:function(){var t=this,e={shop_id:this.shopId};this.$store.dispatch("commodity/getSetMealList",e).then((function(e){for(var a=e.buffets,s=0;s<a.length;s++)a[s].deletFlag=!1;t.tableData=a,t.submitflag=!1,t.ruleForm.set_name="",t.ruleForm.set_price="",t.ruleForm.set_time="",t.ruleForm.set_photo_url=""})).catch((function(e){console.log(e),t.submitflag=!1,t.deletFlag=!1}))},getProductInfo:function(){var t=this,e=this.$route.params.id;this.$store.dispatch("commodity/getProductInfo",e).then((function(e){var a=Object(r.d)(e,["category_id","name","description","size","id","shop_id","oss_url"]);t.form=Object(s.a)(Object(s.a)({},t.form),a)}))},beforeAvatarUpload:function(t){var e="image/jpeg"===t.type||"image/png",a=t.size/1024/1024<2;e||this.$message.error(this.$t("error.picTypeErr")),a||this.$message.error(this.$t("error.picMaxErr"))},uploadFile:function(t){var e=this;console.log(t),this.avatarLoading=!0,Object(i.b)(t).then((function(t){e.avatarLoading=!1,Object(n.a)(),console.log(t.Location),e.set_photo_url=t.Location}),(function(t){e.avatarLoading=!1,Object(n.a)(),t.msg||e.$message.error(e.$t("error.picUploadErr"))}))}},computed:Object(s.a)({},Object(o.d)({shopId:function(t){return t.user.loginData.id}}))},u=(a("6028"),a("2877")),d=Object(u.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"buffet_wrapper"},[a("el-row",[a("el-col",{attrs:{span:4}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.uploadFile,"before-upload":t.beforeAvatarUpload}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.avatarLoading,expression:"avatarLoading"}],staticClass:"avatar_loading"}),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.avatarLoading,expression:"!avatarLoading"}]},[a("img",{staticClass:"avatar",attrs:{src:t.set_photo_url}}),a("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" "+t._s(t.$t("public.picInfo"))+" ")])])])],1),a("el-col",{attrs:{span:20}},[a("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:t.$t("buffet.setMeal"),prop:"set_name"}},[a("el-input",{model:{value:t.ruleForm.set_name,callback:function(e){t.$set(t.ruleForm,"set_name",e)},expression:"ruleForm.set_name"}})],1),a("el-form-item",{attrs:{label:t.$t("buffet.setPrice"),prop:"set_price"}},[a("el-input",{staticStyle:{width:"130px"},attrs:{type:"number"},model:{value:t.ruleForm.set_price,callback:function(e){t.$set(t.ruleForm,"set_price",e)},expression:"ruleForm.set_price"}})],1),a("el-form-item",{attrs:{label:t.$t("buffet.timeLimit"),prop:"set_time"}},[a("el-input",{staticStyle:{width:"130px"},attrs:{placeholder:t.$t("buffet.minutes"),type:"number"},model:{value:t.ruleForm.set_time,callback:function(e){t.$set(t.ruleForm,"set_time",e)},expression:"ruleForm.set_time"}}),a("el-button",{staticClass:"btn",staticStyle:{"margin-left":"100px"},attrs:{type:"primary",loading:t.submitflag},on:{click:function(e){return t.submitForm("ruleForm")}}},[t._v(t._s(t.$t("buffet.submit")))])],1)],1)],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"","header-cell-style":{"text-align":"center"},"cell-style":{"text-align":"center"}}},[a("el-table-column",{attrs:{prop:"set_name",label:t.$t("buffet.setMeals"),width:"180"}}),a("el-table-column",{attrs:{prop:"set_price",label:t.$t("buffet.setPrices"),width:"100"}}),a("el-table-column",{attrs:{prop:"set_time",label:t.$t("buffet.timeLimits"),width:"100"}}),a("el-table-column",{attrs:{label:t.$t("buffet.foodDetails"),width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.buffet_detail,(function(e){return a("span",{key:e.buffet_detail},[t._v(t._s(e.products_name+"、"))])}))}}])}),a("el-table-column",{attrs:{prop:"buffet_detail",label:t.$t("buffet.operation")},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{placeholder:t.$t("buffet.add")},on:{change:function(a){return t.add(e.row.buffet_id,e.row.name,e.$index)}},model:{value:e.row.name,callback:function(a){t.$set(e.row,"name",a)},expression:"scope.row.name"}},t._l(t.options,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id,disabled:t.disabled}})})),1),a("el-button",{staticClass:"btn",staticStyle:{"margin-left":"20px"},attrs:{type:"primary",plain:"",size:"small",loading:t.tableData[e.$index].deletFlag},on:{click:function(a){return t.delet(e.row.buffet_id,e.$index)}}},[t._v(t._s(t.$t("btn.delete")))])]}}])})],1)],1)}),[],!1,null,"78360386",null);e.default=d.exports},6028:function(t,e,a){"use strict";a("e5df")},"874c":function(t,e,a){"use strict";a.d(e,"b",(function(){return c})),a.d(e,"a",(function(){return u}));a("baa5"),a("fb6a"),a("b0c0"),a("d3b7");var s=a("0da4"),o=a.n(s),r=a("2b0e"),i=a("9923"),n=a("e43c");o.a.config.update({region:"ap-southeast-2",credentials:new o.a.CognitoIdentityCredentials({IdentityPoolId:"ap-southeast-2:3690eca5-99fb-4e84-8cf4-74ec0ac8162c"})});var l=new o.a.S3({apiVersion:"2006-03-01",params:{Bucket:"test.znox.top.images"}});function c(t){Object(n.b)(".avatar_loading");var e=t.file,a="image/jpeg"===e.type||"image/png"===e.type,s=e.size/1024/1024<2;if(!a)return r.default.prototype.$message({showClose:!0,message:i.a.t("error.picTypeErr"),type:"error"}),Promise.reject({msg:"uploaderr"});if(!s)return r.default.prototyoe.$message({showClose:!0,message:i.a.t("error.picMaxErr"),type:"error"}),Promise.reject({msg:"uploaderr"});var o=e.name.lastIndexOf("."),c=e.name.slice(o,e.name.length),u="static/images/"+e.uid+c;return l.upload({Bucket:"test.znox.top.images",Key:u,Body:e,ACL:"public-read"},{partSize:10485760,queueSize:1}).promise()}function u(t){var e=t.file;return console.log(e),l.upload({Bucket:"test.znox.top.images",Key:"index.html",Body:e,ACL:"public-read"}).promise().then((function(t){console.log("success",t)}),(function(t){console.log("failed",t)}))}},e43c:function(t,e,a){"use strict";a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return i}));var s,o=a("5c96");function r(t){var e={text:"loading......",background:"rgba(255, 255, 255, 0.6)",target:document.querySelector(t)||"body",customClass:"server_loading"};s=o.Loading.service(e)}function i(){s.close()}},e5df:function(t,e,a){}}]);
//# sourceMappingURL=chunk-23d5c538.4eab1f20.js.map